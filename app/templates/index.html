<!DOCTYPE html>
<html>
<head>
    <title>Bird Classifier</title>
    <style>
        #preview {
            max-width: 300px;
            max-height: 300px;
            display: none;
            margin-top: 10px;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
    <script>
        let predicted = false;

        function handleFileChange() {
            const fileInput = document.getElementById("file");
            const preview = document.getElementById("preview");
            const predictBtn = document.getElementById("predictBtn");
            const clearBtn = document.getElementById("clearBtn");
            const result = document.getElementById("result");

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                preview.src = URL.createObjectURL(file);
                preview.style.display = "block";
                predictBtn.disabled = false;
                clearBtn.style.display = "inline";
                result.innerText = "";
                predicted = false;
            } else {
                preview.style.display = "none";
                predictBtn.disabled = true;
                clearBtn.style.display = "none";
            }
        }

        async function handlePredict(event) {
            event.preventDefault();
            const fileInput = document.getElementById("file");
            const predictBtn = document.getElementById("predictBtn");
            const result = document.getElementById("result");

            if (fileInput.files.length === 0) return;

            predictBtn.disabled = true;
            predictBtn.innerText = "Predicting...";

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);

            try {
                const response = await fetch("/predict", {
                    method: "POST",
                    body: formData
                });
                const data = await response.json();
                result.innerText = `Prediction: ${data.prediction}`;
                predicted = true;
            } catch (err) {
                result.innerText = "Error predicting.";
                console.error(err);
            } finally {
                predictBtn.innerText = "Predict";
                predictBtn.disabled = predicted; // disable if already predicted
            }
        }

        function handleClear() {
            const fileInput = document.getElementById("file");
            const preview = document.getElementById("preview");
            const predictBtn = document.getElementById("predictBtn");
            const clearBtn = document.getElementById("clearBtn");
            const result = document.getElementById("result");

            fileInput.value = "";
            preview.src = "";
            preview.style.display = "none";
            predictBtn.disabled = true;
            clearBtn.style.display = "none";
            result.innerText = "";
            predicted = false;
        }
    </script>
</head>
<body>
    <h1>Upload a Bird Image</h1>

    <form onsubmit="handlePredict(event)">
        <input type="file" id="file" accept="image/*" onchange="handleFileChange()" required>
        <button type="submit" id="predictBtn" disabled>Predict</button>
        <button type="button" id="clearBtn" onclick="handleClear()" style="display:none;">Clear</button>
    </form>

    <div>
        <img id="preview" alt="Image preview">
    </div>
    <h2 id="result"></h2>
</body>
</html>
